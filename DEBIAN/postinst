#!/bin/sh
# postinst script for wanparty-vpn-client
#
# see: dh_installdeb(1)
set -e
case "$1" in
    configure)
    echo "Config portal"
    cp /usr/share/wanparty/etc/sudoers.d/* /etc/sudoers.d/ 
    cp -rfv /usr/share/wanparty/portal/etc/apache2 /etc/
    cp -rfv /usr/share/wanparty/portal/var/www/http /var/www/
    cp -rfv /usr/share/wanparty/portal/var/www/https /var/www/
    mkdir -p /var/www/data
    if [ -f /var/www/data/auth.db ];
    then
        cp /var/www/data/auth.db /var/www/data/auth.db.old
    fi
    cp -rfv /usr/share/wanparty/portal/var/www/data/auth.db /var/www/data/auth.db
    chown www-data:www-data -R /var/www/
    chmod +w -R /var/www/data/auth.db
    rm -fvr /var/www/html

    a2enmod ssl
    a2dissite 000-default || :
    a2ensite default-ssl
    a2ensite default
    systemctl restart apache2     
    
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
